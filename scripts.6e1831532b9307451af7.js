let selectedPiece,intervalID,interval=1e3,clearedLines=0,level=1,nextLevel=!1,score=0,gameToEnd=!1,gameRunning=!1;function renderSelectedPiece(){for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&$("td[x="+x+"][y="+y+"]").css("background-color",selectedPiece.color),-1==selectedPiece.pos[y][x]&&($("td[x="+x+"][y="+y+"]").css("background-color",boardBackground),selectedPiece.pos[y][x]=0)}function renderGameBoard(){for(x=0;x<10;x++)for(y=0;y<20;y++)$("td[x="+x+"][y="+y+"]").css("background-color",gameBoardColoring[y][x]);$(".cleared-lines-points").text(clearedLines),$(".score").text(score),nextLevel&&(level++,nextLevel=!1,$(".level").text(level),interval=1e3*Math.pow(.8-.007*(level-1),level-1),clearInterval(intervalID),gravity()),renderSelectedPiece()}function flashDeletedLine(e){for(y=0;y<e.length;y++)for(x=0;x<10;x++)$("td[x="+x+"][y="+e[y]+"]").css("background-color","white")}function spawnNewPiece(){if(selectedPiece){for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&(gameBoard[y][x]=1,gameBoardColoring[y][x]=selectedPiece.color);let e=[];for(y=19;y>0;y--){let r=gameBoard[y],o=!0;for(x=0;x<10;x++)1!=r[x]&&(o=!1);1==o&&e.push(y)}e.length&&(score+=(2*e.length-1)*level,flashDeletedLine(e),setTimeout(function(){for(y=0;y<e.length;y++){for(x=0;x<10;x++)gameBoard[e[y]+y][x]=0,gameBoardColoring[e[y]+y][x]=boardBackground;let r=e[y]+y;for(;r>0;){for(x=0;x<10;x++)gameBoard[r][x]=gameBoard[r-1][x],gameBoardColoring[r][x]=gameBoardColoring[r-1][x];r--}clearedLines++,clearedLines%10==0&&(nextLevel=!0)}renderGameBoard()},40))}for(selectedPiece=piecesArray[Math.floor(7*Math.random())],console.log(selectedPiece),x=0;x<10;x++)for(y=0;y<20;y++)selectedPiece.pos[y][x]=selectedPiece.initpos[y][x],selectedPiece.pos[y][x]==gameBoard[y][x]&&1==gameBoard[y][x]&&(gameToEnd=!0);selectedPiece.xMax=selectedPiece.xMaxInit,selectedPiece.xMin=selectedPiece.xMinInit,selectedPiece.yMax=selectedPiece.yMaxInit,selectedPiece.offsetX=0,selectedPiece.offsetY=0,selectedPiece.rotationCounter=0,renderSelectedPiece(),gameToEnd&&gameOver()}function gravity(){intervalID=setInterval(function(){moveDown()},interval)}function startgame(){if(!gameRunning){for(x=0;x<10;x++)for(y=0;y<20;y++)gameBoard[y][x]=0,gameBoardColoring[y][x]=boardBackground,$("td[x="+x+"][y="+y+"]").css("background-color",gameBoardColoring[y][x]);$(".context-message").text(""),$(".game-over-message").text(""),$(".cleared-lines-points").text(clearedLines),$(".score").text(score),$(".level").text(level),spawnNewPiece(),gravity(),gameRunning=!0}}function gameOver(){$(".context-message").text("Click here to Play again"),$(".game-over-message").text("GAME OVER"),clearInterval(intervalID),selectedPiece=void 0,interval=1e3,clearedLines=0,level=1,nextLevel=!1,score=0,gameRunning=!1,gameToEnd=!1}function moveLeft(){if(selectedPiece.xMin>0){for(selectedPiece.xMin--,selectedPiece.xMax--,selectedPiece.offsetX--,x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&(selectedPiece.pos[y][x-1]=1,selectedPiece.pos[y][x]=-1);let e=!1;for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&selectedPiece.pos[y][x]==gameBoard[y][x]&&(e=!0);if(e){for(x=9;x>=0;x--)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&(selectedPiece.pos[y][x+1]=1,selectedPiece.pos[y][x]=0);selectedPiece.xMin++,selectedPiece.xMax++,selectedPiece.offsetX++}}renderSelectedPiece()}function moveRight(){if(selectedPiece.xMax<9){for(selectedPiece.xMin++,selectedPiece.xMax++,selectedPiece.offsetX++,x=9;x>=0;x--)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&(selectedPiece.pos[y][x+1]=1,selectedPiece.pos[y][x]=-1);let e=!1;for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&selectedPiece.pos[y][x]==gameBoard[y][x]&&(e=!0);if(e){for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&(selectedPiece.pos[y][x-1]=1,selectedPiece.pos[y][x]=0);selectedPiece.xMin--,selectedPiece.xMax--,selectedPiece.offsetX--}}renderSelectedPiece()}function moveDown(){if(selectedPiece.yMax++,selectedPiece.offsetY++,selectedPiece.yMax<20){for(x=0;x<10;x++)for(y=19;y>=0;y--)1==selectedPiece.pos[y][x]&&(selectedPiece.pos[y+1][x]=1,selectedPiece.pos[y][x]=-1);let e=!1;for(x=0;x<10;x++)for(y=19;y>=0;y--)1==selectedPiece.pos[y][x]&&selectedPiece.pos[y][x]==gameBoard[y][x]&&(e=!0);if(e){for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&(selectedPiece.pos[y-1][x]=1,selectedPiece.pos[y][x]=0);spawnNewPiece()}else renderSelectedPiece()}else spawnNewPiece()}function rotate(){if(selectedPiece.rotationCounter++,selectedPiece.rotationCounter==selectedPiece.rotationRule.length&&(selectedPiece.rotationCounter=0),selectedPiece.xMin+=selectedPiece.rotX[selectedPiece.rotationCounter][0],selectedPiece.xMax+=selectedPiece.rotX[selectedPiece.rotationCounter][1],selectedPiece.yMax+=selectedPiece.rotX[selectedPiece.rotationCounter][2],selectedPiece.xMax<10&&selectedPiece.xMin>=0&&selectedPiece.yMax<20){for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&(selectedPiece.pos[y][x]=-1);for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.rotationRule[selectedPiece.rotationCounter][y][x]&&(selectedPiece.pos[y+selectedPiece.offsetY][x+selectedPiece.offsetX]=1);let e=!1;for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&selectedPiece.pos[y][x]==gameBoard[y][x]&&(e=!0);if(e){for(selectedPiece.xMin-=selectedPiece.rotX[selectedPiece.rotationCounter][0],selectedPiece.xMax-=selectedPiece.rotX[selectedPiece.rotationCounter][1],selectedPiece.yMax-=selectedPiece.rotX[selectedPiece.rotationCounter][2],selectedPiece.rotationCounter--,selectedPiece.rotationCounter<0&&(selectedPiece.rotationCounter=selectedPiece.rotationRule.length-1),x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.pos[y][x]&&(selectedPiece.pos[y][x]=0);for(x=0;x<10;x++)for(y=0;y<20;y++)1==selectedPiece.rotationRule[selectedPiece.rotationCounter][y][x]&&(selectedPiece.pos[y+selectedPiece.offsetY][x+selectedPiece.offsetX]=1)}}else selectedPiece.xMin-=selectedPiece.rotX[selectedPiece.rotationCounter][0],selectedPiece.xMax-=selectedPiece.rotX[selectedPiece.rotationCounter][1],selectedPiece.yMax-=selectedPiece.rotX[selectedPiece.rotationCounter][2],selectedPiece.rotationCounter--,selectedPiece.rotationCounter<0&&(selectedPiece.rotationCounter=selectedPiece.rotationRule.length-1);renderSelectedPiece()}!function(){var e=$.support.touch,r=e?"touchstart":"mousedown",o=e?"touchend":"mouseup",t=e?"touchmove":"mousemove";$.event.special.swipeupdown={setup:function(){var e=$(this);e.bind(r,function(r){var a,c=r.originalEvent.touches?r.originalEvent.touches[0]:r,i={time:(new Date).getTime(),coords:[c.pageX,c.pageY],origin:$(r.target)};function s(e){if(i){var r=e.originalEvent.touches?e.originalEvent.touches[0]:e;a={time:(new Date).getTime(),coords:[r.pageX,r.pageY]},Math.abs(i.coords[1]-a.coords[1])>10&&e.preventDefault()}}e.bind(t,s).one(o,function(r){e.unbind(t,s),i&&a&&a.time-i.time<1e3&&Math.abs(i.coords[1]-a.coords[1])>30&&Math.abs(i.coords[0]-a.coords[0])<75&&i.origin.trigger("swipeupdown").trigger(i.coords[1]>a.coords[1]?"swipeup":"swipedown"),i=a=void 0})})}},$.each({swipedown:"swipeupdown",swipeup:"swipeupdown"},function(e,r){$.event.special[e]={setup:function(){$(this).bind(r,$.noop)}}})}(),$(document).keydown(function(e){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code)>-1&&e.preventDefault(),gameRunning)switch(e.key){case"ArrowLeft":moveLeft();break;case"ArrowRight":moveRight();break;case"ArrowUp":rotate();break;case"ArrowDown":moveDown()}}),$(document).on("swipeleft",function(e){moveLeft()}),$(document).on("swiperight",function(e){moveRight()}),$(document).on("swipedown",function(e){console.log("swipedown"),moveDown()}),$(document).on("tap",function(e){gameRunning&&rotate()});const purple="#8e44ad",orange="#e67e22",lightBlue="#3498db",darkBlue="#2980b9",red="#e74c3c",green="#2ecc71",yellow="#f1c40f",boardBackground="#303030";class Piece{constructor(e,r,o,t,a,c,i,s){this.initpos=e,this.pos=r,this.color=o,this.xMin=t,this.xMax=a,this.yMax=c,this.xMinInit=t,this.xMaxInit=a,this.yMaxInit=c,this.rotationCounter=0,this.offsetX=0,this.offsetY=0,this.rotationRule=i,this.rotX=s}}var tArray=[],tArrayRot1=[],tArrayRot2=[],tArrayRot3=[],iArray=[],iArrayRot1=[],oArray=[],sArray=[],sArrayRot1=[],zArray=[],zArrayRot1=[],lArray=[],lArrayRot1=[],lArrayRot2=[],lArrayRot3=[],llArray=[],llArrayRot1=[],llArrayRot2=[],llArrayRot3=[],tArrayPos=[],iArrayPos=[],oArrayPos=[],sArrayPos=[],zArrayPos=[],lArrayPos=[],llArrayPos=[],gameBoard=[],gameBoardColoring=[];for(x=0;x<20;x++)tArray.push([0,0,0,0,0,0,0,0,0,0]),tArrayRot1.push([0,0,0,0,0,0,0,0,0,0]),tArrayRot2.push([0,0,0,0,0,0,0,0,0,0]),tArrayRot3.push([0,0,0,0,0,0,0,0,0,0]),iArray.push([0,0,0,0,0,0,0,0,0,0]),iArrayRot1.push([0,0,0,0,0,0,0,0,0,0]),oArray.push([0,0,0,0,0,0,0,0,0,0]),sArray.push([0,0,0,0,0,0,0,0,0,0]),sArrayRot1.push([0,0,0,0,0,0,0,0,0,0]),zArray.push([0,0,0,0,0,0,0,0,0,0]),zArrayRot1.push([0,0,0,0,0,0,0,0,0,0]),lArray.push([0,0,0,0,0,0,0,0,0,0]),lArrayRot1.push([0,0,0,0,0,0,0,0,0,0]),lArrayRot2.push([0,0,0,0,0,0,0,0,0,0]),lArrayRot3.push([0,0,0,0,0,0,0,0,0,0]),llArray.push([0,0,0,0,0,0,0,0,0,0]),llArrayRot1.push([0,0,0,0,0,0,0,0,0,0]),llArrayRot2.push([0,0,0,0,0,0,0,0,0,0]),llArrayRot3.push([0,0,0,0,0,0,0,0,0,0]),tArrayPos.push([0,0,0,0,0,0,0,0,0,0]),iArrayPos.push([0,0,0,0,0,0,0,0,0,0]),oArrayPos.push([0,0,0,0,0,0,0,0,0,0]),sArrayPos.push([0,0,0,0,0,0,0,0,0,0]),zArrayPos.push([0,0,0,0,0,0,0,0,0,0]),lArrayPos.push([0,0,0,0,0,0,0,0,0,0]),llArrayPos.push([0,0,0,0,0,0,0,0,0,0]),gameBoard.push([0,0,0,0,0,0,0,0,0,0]),gameBoardColoring.push([boardBackground,boardBackground,boardBackground,boardBackground,boardBackground,boardBackground,boardBackground,boardBackground,boardBackground,boardBackground]);tArray[0][4]=1,tArray[1][3]=1,tArray[1][4]=1,tArray[1][5]=1,tArrayRot1[0][4]=1,tArrayRot1[1][3]=1,tArrayRot1[1][4]=1,tArrayRot1[2][4]=1,tArrayRot2[1][3]=1,tArrayRot2[1][4]=1,tArrayRot2[1][5]=1,tArrayRot2[2][4]=1,tArrayRot3[0][4]=1,tArrayRot3[1][4]=1,tArrayRot3[2][4]=1,tArrayRot3[1][5]=1,iArray[0][5]=1,iArray[1][5]=1,iArray[2][5]=1,iArray[3][5]=1,iArrayRot1[0][3]=1,iArrayRot1[0][4]=1,iArrayRot1[0][5]=1,iArrayRot1[0][6]=1,oArray[0][4]=1,oArray[0][5]=1,oArray[1][4]=1,oArray[1][5]=1,sArray[0][4]=1,sArray[0][5]=1,sArray[1][3]=1,sArray[1][4]=1,sArrayRot1[0][4]=1,sArrayRot1[1][4]=1,sArrayRot1[1][5]=1,sArrayRot1[2][5]=1,zArray[0][3]=1,zArray[0][4]=1,zArray[1][4]=1,zArray[1][5]=1,zArrayRot1[0][4]=1,zArrayRot1[1][3]=1,zArrayRot1[1][4]=1,zArrayRot1[2][3]=1,lArray[0][4]=1,lArray[1][4]=1,lArray[2][4]=1,lArray[2][5]=1,lArrayRot1[0][5]=1,lArrayRot1[1][3]=1,lArrayRot1[1][4]=1,lArrayRot1[1][5]=1,lArrayRot2[0][3]=1,lArrayRot2[0][4]=1,lArrayRot2[1][4]=1,lArrayRot2[2][4]=1,lArrayRot3[1][3]=1,lArrayRot3[1][4]=1,lArrayRot3[1][5]=1,lArrayRot3[2][3]=1,llArray[0][4]=1,llArray[0][5]=1,llArray[1][4]=1,llArray[2][4]=1,llArrayRot1[1][3]=1,llArrayRot1[1][4]=1,llArrayRot1[1][5]=1,llArrayRot1[2][5]=1,llArrayRot2[0][4]=1,llArrayRot2[1][4]=1,llArrayRot2[2][3]=1,llArrayRot2[2][4]=1,llArrayRot3[0][3]=1,llArrayRot3[1][3]=1,llArrayRot3[1][4]=1,llArrayRot3[1][5]=1;const tArrayRotations=[tArray,tArrayRot1,tArrayRot2,tArrayRot3],tArrayRot=[[-1,0,-1],[0,-1,1],[0,1,0],[1,0,0]],iArrayRotations=[iArray,iArrayRot1],iArrayRot=[[2,-1,3],[-2,1,-3]],sArrayRotations=[sArray,sArrayRot1],sArrayRot=[[-1,0,-1],[1,0,1]],zArrayRotations=[zArray,zArrayRot1],zArrayRot=[[0,1,-1],[0,-1,1]],lArrayRotations=[lArray,lArrayRot1,lArrayRot2,lArrayRot3],lArrayRot=[[1,0,0],[-1,0,-1],[0,-1,1],[0,1,0]],llArrayRotations=[llArray,llArrayRot1,llArrayRot2,llArrayRot3],llArrayRot=[[1,0,1],[-1,0,0],[0,-1,0],[0,1,-1]],oArrayRotations=[oArray],oArrayRot=[[0,0,0]],tPiece=new Piece(tArray,tArrayPos,purple,3,5,1,tArrayRotations,tArrayRot),iPiece=new Piece(iArray,iArrayPos,"#3498db",5,5,3,iArrayRotations,iArrayRot),oPiece=new Piece(oArray,oArrayPos,yellow,4,5,1,oArrayRotations,oArrayRot),sPiece=new Piece(sArray,sArrayPos,green,3,5,1,sArrayRotations,sArrayRot),zPiece=new Piece(zArray,zArrayPos,red,3,5,1,zArrayRotations,zArrayRot),lPiece=new Piece(lArray,lArrayPos,orange,4,5,2,lArrayRotations,lArrayRot),llPiece=new Piece(llArray,llArrayPos,darkBlue,4,5,2,llArrayRotations,llArrayRot),piecesArray=[tPiece,iPiece,oPiece,sPiece,zPiece,lPiece,llPiece];function startNavigation(){var e=$("#sidebar").offset(),r=$(".section");$(document).scroll(function(){console.log(e),e.top<$(window).scrollTop()?$("body").addClass("fixed"):$("body").removeClass("fixed"),r.each(function(r){var o=$(this).offset().top-$(window).scrollTop();if(o<e.top&&o+$(this).height()>0){var t="#nb-"+$(this).attr("id");console.log("#nb-"+$(this).attr("id")),$(".navblock-active").removeClass("navblock-active"),$(t).addClass("navblock-active")}})})}$(document).ready(function(){startNavigation()});